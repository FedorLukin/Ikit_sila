# --------------------------------------------------------------------------------
# Stage 1: Base Environment
# Используем образ Node.js
FROM node:20-alpine as base

# Установка рабочей директории
WORKDIR /app

# --------------------------------------------------------------------------------
# Stage 2: Dependencies Installation
FROM base as deps

# Копируем файлы манифеста зависимостей из frontend/
# Предполагаем, что package.json и package-lock.json находятся в frontend/
COPY package*.json /app/

# Устанавливаем зависимости
# Используем команду 'ci' для более надежной установки
RUN npm install

# --------------------------------------------------------------------------------
# Stage 3: Development Server
FROM base as dev

# Установка рабочей директории
WORKDIR /app

# Копируем установленные зависимости из этапа deps
COPY --from=deps /app/node_modules /app/node_modules

# Копируем исходный код фронтенда
# Копируем все из frontend/ в /app
COPY . /app/

# Порт, который использует Vite/Webpack/CRA dev-сервер (обычно 3000 или 5173)
# Уточните порт в зависимости от конфигурации React-проекта. Используем 3000 как стандарт.
ENV PORT 5173
EXPOSE ${PORT}

# Команда запуска dev-сервера
# Привязка к 0.0.0.0 требуется для доступа извне контейнера
CMD ["npm", "run", "dev", "--", "--host", "0.0.0.0"]
